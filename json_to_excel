import pandas as pd
import json
import sys
import os

def json_to_excel():
    """Convert weather_data_all_grid_points.json to Excel"""
    json_file = "output/weather_data_all_grid_points.json"
    excel_file = "output/weather_data.xlsx"
    
    # V√©rifier si le fichier existe
    if not os.path.exists(json_file):
        print(f"‚ùå Fichier non trouv√©: {json_file}")
        print(f"üìÅ R√©pertoire courant: {os.getcwd()}")
        return
    
    print(f"üìñ Lecture de {json_file}...")
    
    with open(json_file, 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    df = pd.json_normalize(
        data['results'], 
        'weather_data', 
        ['geohash', 'point_name', 'latitude', 'longitude']
    )
    
    df.to_excel(excel_file, index=False)
    print(f"‚úÖ Conversion r√©ussie! {len(df)} lignes")
    print(f"üìÅ Fichier: {excel_file}")
    df.to_excel(r'C:\Users\Lenovo\Desktop\weather_data.xlsx', index=False)
    print(f"‚úÖ Fichier √©galement enregistr√© sur le bureau: C:\\Users\\Lenovo\\Desktop\\weather_data.xlsx")

if __name__ == "__main__":
    json_to_excel()